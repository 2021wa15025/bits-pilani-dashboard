import{r,$ as U,a0 as L,a1 as g,j as e,B as y,a2 as X,a3 as Q,h as E,A as Z,F as q,H as j,J as b,C as m,i as u,k as p,a as x,P as ee,K as N,M as F,a4 as se,a5 as te}from"./index-EOvVHa2o.js";function ce({course:t,onBack:O}){const[J,G]=r.useState("overview"),[ae,ie]=r.useState(null),[f,K]=r.useState([]),[T,Y]=r.useState([]),[k,A]=r.useState([]),[M,R]=r.useState(!1),[re,_]=r.useState(Date.now()),[S,z]=r.useState(null),[C,D]=r.useState(null),[H,V]=r.useState(0),[le,ne]=r.useState([]),v=async()=>{try{const s=localStorage.getItem(`syllabus_${t.id}`),c=localStorage.getItem(`notes_${t.id}`);if(s){const a=JSON.parse(s);z(a.length>0?a:null)}if(c){const a=JSON.parse(c);D(a.length>0?a:null)}!s&&!c&&(z(null),D(null));try{const a=await fetch(`https://${U}.supabase.co/functions/v1/make-server-917daa5d/course-materials/${t.id}`,{headers:{Authorization:`Bearer ${L}`}});if(a.ok){const d=await a.json(),i=d.materials?d.materials.filter(h=>h.type==="syllabus"):[],o=d.materials?d.materials.filter(h=>h.type==="note"):[];i.length>0&&(z(i),localStorage.setItem(`syllabus_${t.id}`,JSON.stringify(i))),o.length>0&&(D(o),localStorage.setItem(`notes_${t.id}`,JSON.stringify(o)))}}catch(a){console.log("Backend sync failed, using localStorage data:",a.message)}}catch(s){console.error("Error loading syllabus/notes:",s),z(null),D(null)}},P=()=>{v(),V(s=>s+1),g.success("Content refreshed successfully!")};r.useEffect(()=>{v()},[t.id,H]),r.useEffect(()=>{v();const s=setInterval(()=>{v()},5e3),c=a=>{console.log("Custom storage event received:",a.detail),(a.detail.key===`syllabus_${t.id}`||a.detail.key===`notes_${t.id}`)&&(v(),g.success(`${a.detail.type==="syllabus"?"Syllabus":"Notes"} updated by admin!`))};return window.addEventListener("localStorageUpdated",c),()=>{clearInterval(s),window.removeEventListener("localStorageUpdated",c)}},[t.id]),r.useEffect(()=>{const s=setInterval(()=>{$()},1e4);return()=>clearInterval(s)},[t.id]),r.useEffect(()=>{$(),I();const s=setInterval(()=>{console.log("ðŸ”„ Auto-refreshing materials and quizzes..."),$(),I(),_(Date.now()),v()},1e4);return()=>clearInterval(s)},[t.id]);const $=async()=>{R(!0);try{const s=await fetch(`https://${U}.supabase.co/functions/v1/make-server-917daa5d/course-materials/${t.id}`,{headers:{Authorization:`Bearer ${L}`}});if(s.ok){const c=await s.json(),a=c.materials.filter(l=>l.type==="paper"),d=c.materials.filter(l=>l.type==="ppt");K(a);const i=Array.from({length:12},(l,n)=>{const w=d.find(W=>W.title.includes(`Session ${n+1}`));return{id:n+1,title:`Session ${n+1}`,topic:`Chapter ${n+1} Topics`,date:`Week ${n+1}`,pptUploaded:!!w,pptUrl:(w==null?void 0:w.fileUrl)||null,pptData:w||null}});Y(i);const o=a.length>f.length,h=d.length>T.filter(l=>l.pptUploaded).length;if((o||h)&&f.length>0){const l=(o?a.length-f.length:0)+(h?d.length-T.filter(n=>n.pptUploaded).length:0);console.log(`ðŸ†• New materials detected! ${a.length} papers, ${d.length} PPTs`),g.success(`${l} new material${l>1?"s":""} uploaded!`,{description:"New content is now available for download.",duration:5e3})}else console.log(`âœ… Student: Loaded ${a.length} papers, ${d.length} PPTs`)}else console.error("Failed to fetch materials: HTTP",s.status),g.error("Failed to load materials",{description:"Please try refreshing the page.",duration:3e3})}catch(s){console.error("Error fetching materials:",s),g.error("Connection error",{description:"Could not sync with server. Retrying...",duration:3e3})}finally{R(!1)}},I=async()=>{try{const s=await fetch(`https://${U}.supabase.co/functions/v1/make-server-917daa5d/course-quizzes/${t.id}`,{headers:{Authorization:`Bearer ${L}`}});if(s.ok){const a=(await s.json()).quizzes.map(i=>{const o=new Date,h=new Date(i.startDate),l=new Date(i.endDate);let n="Not Available";return o>=h&&o<=l?n="Available":o>l?n="Completed":n="Upcoming",{id:i.id,title:i.title,link:i.link,startDate:new Date(i.startDate).toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"}),endDate:new Date(i.endDate).toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"}),maxMarks:i.maxMarks||5,status:n,score:null}});if(a.length>k.length&&k.length>0){const i=a.length-k.length;console.log(`ðŸ†• ${i} new quiz${i>1?"zes":""} added!`),g.info(`${i} new quiz${i>1?"zes":""} available!`,{description:"Check the Quizzes tab to take them.",duration:5e3})}A(a),console.log(`âœ… Student: Loaded ${a.length} quizzes from backend`)}else console.log("Failed to fetch quizzes from backend"),A([])}catch(s){console.error("Error fetching quizzes:",s),A([])}},B=()=>k;return t.status==="completed"&&t.grades.total?Math.round(t.grades.total/100*100):t.progress,e.jsxs("div",{className:"min-h-screen bg-university-light",children:[e.jsx("div",{className:"bg-[#191f5e] border-b border-university-border sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[e.jsxs(y,{variant:"ghost",size:"sm",onClick:O,className:"gap-1 sm:gap-2 bg-white/20 text-white hover:bg-white/30 hover:text-white transition-all duration-200 active:scale-95 shrink-0",children:[e.jsx(X,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Back to Courses"]}),e.jsxs("div",{className:"flex-1 min-w-0 w-full sm:w-auto",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-white truncate",children:t.title}),e.jsxs("p",{className:"text-sm text-white/80 truncate",children:[t.code," â€¢ Semester ",t.semester]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>{$(),I(),P(),_(Date.now())},disabled:M,className:"text-white hover:bg-white/20 gap-1",title:"Refresh materials",children:[e.jsx(Q,{className:`w-3 h-3 ${M?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline text-xs",children:"Sync"})]}),e.jsx(E,{className:"bg-blue-600 text-white px-2 sm:px-4 py-1 sm:py-2 text-xs shrink-0",children:"Student View"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-6",children:e.jsxs(Z,{value:J,onValueChange:G,children:[e.jsxs(q,{className:"mb-6 bg-[#191f5e] dark:bg-slate-800 rounded-lg md:rounded-xl w-full p-1",children:[e.jsx(j,{value:"overview",className:"text-white data-[state=active]:bg-white data-[state=active]:text-[#191f5e] dark:data-[state=active]:bg-white dark:data-[state=active]:text-[#191f5e] rounded-md md:rounded-xl text-sm md:text-base px-3 md:px-4 py-2 md:py-2.5 flex-1 font-medium",children:"Overview"}),e.jsx(j,{value:"syllabus",className:"text-white data-[state=active]:bg-white data-[state=active]:text-[#191f5e] dark:data-[state=active]:bg-white dark:data-[state=active]:text-[#191f5e] rounded-md md:rounded-xl text-sm md:text-base px-3 md:px-4 py-2 md:py-2.5 flex-1 font-medium",children:"Syllabus"}),e.jsx(j,{value:"notes",className:"text-white data-[state=active]:bg-white data-[state=active]:text-[#191f5e] dark:data-[state=active]:bg-white dark:data-[state=active]:text-[#191f5e] rounded-md md:rounded-xl text-sm md:text-base px-3 md:px-4 py-2 md:py-2.5 flex-1 font-medium",children:"Notes"}),e.jsx(j,{value:"quizzes",className:"text-white data-[state=active]:bg-white data-[state=active]:text-[#191f5e] dark:data-[state=active]:bg-white dark:data-[state=active]:text-[#191f5e] rounded-md md:rounded-xl text-sm md:text-base px-3 md:px-4 py-2 md:py-2.5 flex-1 font-medium",children:"Quizzes"}),e.jsx(j,{value:"papers",className:"text-white data-[state=active]:bg-white data-[state=active]:text-[#191f5e] dark:data-[state=active]:bg-white dark:data-[state=active]:text-[#191f5e] rounded-md md:rounded-xl text-sm md:text-base px-3 md:px-4 py-2 md:py-2.5 flex-1 font-medium",children:"Papers"}),e.jsx(j,{value:"sessions",className:"text-white data-[state=active]:bg-white data-[state=active]:text-[#191f5e] dark:data-[state=active]:bg-white dark:data-[state=active]:text-[#191f5e] rounded-md md:rounded-xl text-sm md:text-base px-3 md:px-4 py-2 md:py-2.5 flex-1 font-medium",children:"Sessions"})]}),e.jsx(b,{value:"overview",children:e.jsxs("div",{className:"space-y-6",children:[t.status==="completed"&&t.grades.finalGrade&&e.jsxs(m,{className:"bg-university-light border-university",children:[e.jsx(u,{children:e.jsx(p,{className:"text-university-primary",children:"Academic Performance"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-university-secondary text-sm",children:"Assignment/Quiz:"}),e.jsxs("p",{className:"text-university-primary font-semibold text-lg",children:[t.grades.assignmentQuiz,"/25"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-university-secondary text-sm",children:"Mid Semester:"}),e.jsxs("p",{className:"text-university-primary font-semibold text-lg",children:[t.grades.midSemester,"/25"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-university-secondary text-sm",children:"Comprehensive:"}),e.jsxs("p",{className:"text-university-primary font-semibold text-lg",children:[t.grades.comprehensive,"/50"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-university-secondary text-sm",children:"Total Marks:"}),e.jsxs("p",{className:"text-university-primary font-semibold text-lg",children:[t.grades.total,"/100"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-university-secondary text-sm",children:"Final Grade: "}),e.jsx("span",{className:"text-university-primary font-semibold text-lg",children:t.grades.finalGrade})]})]})})]}),t.status==="ongoing"&&e.jsxs(m,{className:"bg-university-light border-university",children:[e.jsx(u,{children:e.jsx(p,{className:"text-university-primary",children:"Current Progress"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-university-secondary",children:"Course Progress:"}),e.jsxs("span",{className:"text-university-primary font-semibold",children:[t.progress,"%"]})]}),e.jsx(ee,{value:t.progress||0,className:"h-3"}),e.jsx("p",{className:"text-sm text-university-secondary",children:"Grades will be available after completion of assessments."})]})})]}),t.status==="upcoming"&&e.jsxs(m,{className:"bg-university-light border-university",children:[e.jsx(u,{children:e.jsx(p,{className:"text-university-primary",children:"Course Information"})}),e.jsx(x,{children:e.jsxs("p",{className:"text-university-secondary",children:["This course is scheduled for Semester ",t.semester,". Course materials and assessments will be available when the semester begins."]})})]})]})}),e.jsx(b,{value:"quizzes",children:e.jsx("div",{className:"space-y-6",children:B().length===0?e.jsx(m,{className:"bg-university-light border-university",children:e.jsx(x,{className:"py-12",children:e.jsxs("div",{className:"text-center text-university-secondary",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No quizzes uploaded yet."}),e.jsx("p",{className:"text-xs mt-1",children:"Your instructor will upload quizzes here when available."})]})})}):B().map(s=>e.jsxs(m,{className:"bg-university-light border-university",children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{className:"text-lg text-university-primary",children:s.title}),e.jsx(E,{className:s.status==="Completed"?"bg-green-500 text-white":s.status==="Available"?"bg-university-primary text-white":s.status==="Upcoming"?"bg-orange-500 text-white":"bg-gray-500 text-white",children:s.status})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-university-secondary text-sm",children:"Start Date:"}),e.jsx("p",{className:"text-university-primary font-medium",children:s.startDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-university-secondary text-sm",children:"End Date:"}),e.jsx("p",{className:"text-university-primary font-medium",children:s.endDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-university-secondary text-sm",children:"Max Marks:"}),e.jsxs("p",{className:"text-university-primary font-medium",children:[s.maxMarks," marks"]})]})]}),s.status==="Available"&&e.jsx("div",{className:"pt-4 border-t border-university-border",children:e.jsxs(y,{className:"bg-university-primary hover:bg-university-primary/90 text-white gap-2 w-full sm:w-auto",onClick:()=>{window.open(s.link,"_blank")},children:[e.jsx(N,{className:"w-4 h-4"}),"Take Quiz (Opens in New Tab)"]})}),s.status==="Upcoming"&&e.jsx("div",{className:"pt-4 border-t border-university-border",children:e.jsxs("p",{className:"text-sm text-university-secondary",children:["This quiz will be available from ",s.startDate]})}),s.status==="Completed"&&e.jsx("div",{className:"pt-4 border-t border-university-border",children:e.jsx("p",{className:"text-sm text-university-secondary",children:"This quiz has ended. Contact your instructor for any queries."})})]})})]},s.id))})}),e.jsx(b,{value:"syllabus",children:e.jsxs(m,{className:"bg-university-light border-university",children:[e.jsx(u,{children:e.jsx(p,{className:"text-university-primary",children:"Syllabus"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:S?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-university-primary",children:"Course Syllabus"}),e.jsxs(y,{variant:"outline",size:"sm",onClick:P,className:"gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"bg-white/50 p-6 rounded-lg border border-university-border",children:e.jsx("div",{style:{whiteSpace:"pre-wrap"},className:"text-university-primary leading-relaxed",children:S.content})})}),e.jsx("div",{className:"text-sm text-university-secondary",children:e.jsxs("p",{children:["Last updated: ",S.updatedAt?new Date(S.updatedAt).toLocaleDateString():"Recently"]})})]}):e.jsxs("div",{className:"text-center py-12 text-university-secondary",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No syllabus uploaded yet."}),e.jsx("p",{className:"text-xs mt-1",children:"Your instructor will upload the syllabus here when available."})]})})})]})}),e.jsx(b,{value:"notes",children:e.jsxs(m,{className:"bg-university-light border-university",children:[e.jsx(u,{children:e.jsx(p,{className:"text-university-primary",children:"Notes"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:C?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-university-primary",children:"Course Notes"}),e.jsxs(y,{variant:"outline",size:"sm",onClick:P,className:"gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"bg-white/50 p-6 rounded-lg border border-university-border",children:e.jsx("div",{style:{whiteSpace:"pre-wrap"},className:"text-university-primary leading-relaxed",children:C.content})})}),e.jsx("div",{className:"text-sm text-university-secondary",children:e.jsxs("p",{children:["Last updated: ",C.updatedAt?new Date(C.updatedAt).toLocaleDateString():"Recently"]})})]}):e.jsxs("div",{className:"text-center py-12 text-university-secondary",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No notes uploaded yet."}),e.jsx("p",{className:"text-xs mt-1",children:"Your instructor will upload notes here when available."})]})})})]})}),e.jsx(b,{value:"papers",children:e.jsxs(m,{className:"bg-university-light border-university",children:[e.jsx(u,{children:e.jsx(p,{className:"text-university-primary",children:"Previous Question Papers"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:f.length===0?e.jsxs("div",{className:"text-center py-12 text-university-secondary",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No question papers uploaded yet."}),e.jsx("p",{className:"text-xs mt-1",children:"Check back later for updates from your instructor."})]}):f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-university-border rounded-lg bg-[rgba(255,255,255,0)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-university-primary p-2 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-university-primary",children:s.title}),e.jsxs("p",{className:"text-sm text-university-secondary",children:["Year: ",s.year," | Semester: ",s.semester]})]})]}),e.jsxs(y,{variant:"outline",size:"sm",className:"gap-2 border-university-primary text-university-primary hover:bg-university-primary hover:text-white",onClick:()=>window.open(s.fileUrl,"_blank"),children:[e.jsx(F,{className:"w-4 h-4"}),"Download"]})]},s.id))})})]})}),e.jsx(b,{value:"sessions",children:e.jsxs(m,{className:"bg-university-light border-university",children:[e.jsx(u,{children:e.jsx(p,{className:"text-university-primary",children:"Session Materials"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:T.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-university-border rounded-lg bg-[rgba(255,249,249,0)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-university-primary p-2 rounded-lg",children:e.jsx(se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-university-primary",children:[s.title,": ",s.topic]}),e.jsx("p",{className:"text-sm text-university-secondary",children:s.date})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.pptUploaded?e.jsxs(y,{variant:"outline",size:"sm",className:"gap-2 border-university-primary text-university-primary hover:bg-university-primary hover:text-white",onClick:()=>window.open(s.pptUrl,"_blank"),children:[e.jsx(F,{className:"w-4 h-4"}),"Download PPT"]}):e.jsx(E,{className:"bg-gray-100 text-gray-600",children:"Not Uploaded"})})]},s.id))})})]})})]})}),e.jsx(te,{})]})}export{ce as default};
//# sourceMappingURL=CourseDetailsPage-H0X8-DAu.js.map
